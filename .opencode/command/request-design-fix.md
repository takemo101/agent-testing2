# 設計修正リクエスト (Design Fix)

実装フェーズ等で発覚した設計不備を修正し、整合性を回復させるためのコマンド。
実装者が「勝手に直す」のではなく、「設計に戻る」プロセスを正規化します。

## 入力
- `issue`: 関連するGitHub Issue番号 (必須)
- `target`: 修正対象の設計書パス (必須)
- `problem`: 発生している問題・不備の説明 (必須)

## 実行フロー

```mermaid
flowchart TB
    REQ[リクエスト受信] --> ANA[問題分析]
    ANA --> PLAN[修正方針策定]
    PLAN --> EDIT[設計書修正<br/>@detailed-design-writer]
    EDIT --> REV{レビュー<br/>@detailed-design-reviewer}
    REV -->|NG| EDIT
    REV -->|OK| TEST_UPD[テスト項目書更新<br/>@test-spec-writer]
    TEST_UPD --> COMMENT[Issueコメント通知]
```

### 1. 問題分析 & 方針策定
- 入力された `problem` と現在の設計書を比較。
- どの部分（ロジック、データ構造、API定義など）を修正すべきか特定する。

### 2. 設計書修正 (`@detailed-design-writer`)
- 修正方針に基づき、設計書 (`.md`) を更新する。
- **注意**: 既存の整合性を壊さないよう、変更は局所化する。大規模な変更が必要な場合はユーザーに確認する。

### 3. レビュー (`@detailed-design-reviewer`)
- 修正内容が妥当かレビューする。
- 2次災害（修正により別の矛盾が生まれること）を防ぐ。

### 4. テスト項目書の追従 (`@test-spec-writer`)
- 設計変更によりテストケースに影響がある場合、テスト項目書も更新する。

### 5. 完了通知
- GitHub Issueに以下のフォーマットでコメントする。

```markdown
## :wrench: 設計修正完了 (Design Fix)

**修正対象**: `{target}`
**修正内容**:
[修正の概要]

**実装者へのメッセージ**:
設計書が更新されました。最新の設計書とテスト項目書をPullして、実装を再開してください。
```

## Sisyphusへの指示

このコマンドは、実装作業中の「割り込み」として機能します。
実装タスクを一時停止し、設計修正タスクを優先実行し、完了後に実装タスクへ戻るよう制御してください。
